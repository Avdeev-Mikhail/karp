<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>Хаотическое перемещение людей</title>
<script type="text/javascript">

Coords = [
	[550, 240],
	[600, 420],
	[430, 580],
	[760, 170],
	[1500, 500],
	[860, 700],
	[1660, 170]
]; //переменная с начальным положением персонажей

function Rectangle( X,Y,DX,DY, R1,G1,B1, R2,G2,B2){
	var canvas = document.getElementById('Image1');
	var Image1Canvas = canvas.getContext('2d');
	Image1Canvas.beginPath();
	Image1Canvas.fillStyle = 'rgb('+R1+', '+G1+', '+B1+')';
	Image1Canvas.fillRect(X,Y,DX,DY);
	Image1Canvas.lineWidth = 1;
	Image1Canvas.strokeStyle = 'rgb('+R2+', '+G2+', '+B2+')';
	Image1Canvas.strokeRect(X,Y,DX,DY);
	Image1Canvas.stroke();
	Image1Canvas.color = (38, 154, 0);
	}; // создание рабочей области 

function Walls(){
	
	Rectangle(110,860,1740,50, 112,80,46, 112,80,46); // Нижняя
	Rectangle(1800,50,50,860, 112,80,46, 112,80,46); // Правая
	Rectangle(110,50,1740,50, 112,80,46, 112,80,46); // Верхняя

	Rectangle(110,50,50,310, 112,80,46, 112,80,46); // Левая верхняя
	Rectangle(110,550,50,310, 112,80,46, 112,80,46); // Левая нижняя

	Rectangle(0,350,160,50, 112,80,46, 112,80,46); //верхний проём
	Rectangle(0,500,160,50, 112,80,46, 112,80,46); //нижний проём
	}; //создание стен

function Floor(){
	Rectangle(160,100,1640,760, 179,179,255, 179,179,255);
	Rectangle(0,400,160,100, 179,179,255, 179,179,255);
	}; // создание декора - пол

function Grass(){
	Rectangle(0,0,1900,960, 38, 153,0, 38, 153,0);
}; // создание декора - трава с улицы

function FormCreate(){
	Grass();
	Walls();
	Floor();
	Timer1Timer();
	}; // создание формы при запуске программы + вызвов функций для рисования объектов

function Timer1Timer(){
	for (var i = 0; i < Coords.length; i++){
		var check = true;
		var X = Coords[i][0] - 25 + 50 * Math.random();
		var Y = Coords[i][1] - 25 + 50 * Math.random();
		var myIndex = i;
		// Проверка на столкновения персонажей. Сверяем, пересекается ли хотя-бы одна из 4 точек с областью другого персонажа.
		for (var k = 0; k < Coords.length; k++){
			if (k != myIndex){ // Чтобы не сверять на столкновение с самим собой.
				var enemyX = Coords[k][0];
				var enemyY = Coords[k][1];
				if (
					(X > enemyX && X < enemyX + 50 && Y > enemyY && Y < enemyY + 54) || // Входит ли левый верхний угол в границы другого персонажа?
					(X + 50 > enemyX && X + 50 < enemyX + 50 && Y > enemyY && Y < enemyY + 54) || // Входит ли правый верхний угол в границы другого персонажа?
					(X > enemyX && X < enemyX + 50 && Y + 54 > enemyY && Y + 54 < enemyY + 54) || // Входит ли левый нижний угол в границы другого персонажа?
					(X + 50 > enemyX && X + 50 < enemyX + 50 && Y + 54 > enemyY && Y + 54 < enemyY + 54) // Входит ли правый нижний угол в границы другого персонажа?
					){
					check = false;
				}
			}
		}
		if (check){
			// Проверка на стены + создается эффект того, что они в них упираются.
			X = X < 160 ? 160 : X; // С левой стеной
			X = X > 1750 ? 1750 : X; // С правой стеной (с учетом ширины персонажа)
			Y = Y > 806 ? 806 : Y; // С нижней стеной (с учетом высоты персонажа)
			Y = Y < 100 ? 100 : Y; // С верхней стеной
			// Конец проверки на стены.
			Coords[i][0] = X;
			Coords[i][1] = Y;
		}
		document.getElementById('Person' + i).style.left = Coords[i][0] + 'px';
		document.getElementById('Person' + i).style.top = Coords[i][1]  + 'px';
	};
	setTimeout('Timer1Timer()', 300); // установка значения для таймера
};

</script>
</head>
<body style="margin: 0;" onload="FormCreate()">

	<canvas id="Image1" width="1900" height="960" color=""></canvas>
	<img id='Person0' src="img/military.gif" style="position: absolute; left: 550px;  top: 240px; width: 50px; height: 54px">
	<img id='Person1' src="img/zombie.gif" style="position: absolute; left: 550px; top: 240px; width: 50px;">
	<img id='Person2' src="img/military.gif" style="position: absolute; left: 430px;  top: 580px; width: 50px; height: 54px">
	<img id='Person3' src="img/zombie.gif" style="position: absolute; left: 760px;  top: 170px; width: 50px;">
	<img id='Person4' src="img/zombie.gif" style="position: absolute; left: 1500px; top: 500px; width: 50px;"> 
	<img id='Person5' src="img/zombie.gif" style="position: absolute; left: 860px;  top: 700px; width: 50px;"> 
	<img id='Person6' src="img/zombie.gif" style="position: absolute; left: 1660px; top: 170px; width: 50px;">                    
	
</body>
</html>